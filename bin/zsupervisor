#! /usr/bin/env bash
##############################################################################
#
# Copyright (C) Zenoss, Inc. 2013, all rights reserved.
#
# This content is made available according to terms specified in
# License.zenoss under the directory where your Zenoss product is installed.
#
##############################################################################

# zsupervisor is a pass through to supervisorctl.

echoerr() { echo "$@" 1>&2; }

if [ -z "$ZENHOME" ] ; then
    echoerr "ERROR: '$ZENHOME' is not set."
    echoerr "This is usually caused by executing this command as root rather than \
as the zenoss user.  Either define '$ZENHOME' or run this command as a \
different user."
    exit 1
fi

PIDFILE=$ZENHOME/var/supervisord.pid
CONF_FILE=$ZENHOME/etc/supervisord.conf
SUPERVISORCTL=`which supervisorctl`
if [ -z "$SUPERVISORCTL" ];then
    echoerr "supervisorctl not in path."
    exit 1
fi

if [ ! -f "$CONF_FILE" ];then
    echoerr "supervisor config not found."
    exit 1
fi

if [ ! -f "$PIDFILE" ];then
    cd $ZENHOME
    supervisord -c $CONF_FILE --pidfile=$PIDFILE -d $ZENHOME -i zenoss
fi


$SUPERVISORCTL -c $CONF_FILE "$@"

