#! /usr/bin/env bash
#############################################################################
# This program is part of Zenoss Core, an open source monitoring platform.
# Copyright (C) 2010, Zenoss Inc.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 as published by
# the Free Software Foundation.
#
# For complete information please visit: http://www.zenoss.com/oss/
#############################################################################

if [ -z "$ZENHOME" ] ; then
    echo ERROR: '$ZENHOME' is not set.
    echo This is usually caused by executing this command as root rather than \
as the zenoss user.  Either define '$ZENHOME' or run this command as a \
different user.
    exit 1
fi


RRDCACHED_ADDRESS=$ZENHOME/var/rrdcached.sock
JOURNALDIR=$ZENHOME/var/rrd_journals
PID=$ZENHOME/var/rrdcached.pid

start() {
    echo "Starting..."
    $ZENHOME/bin/rrdcached -p $PID -l $RRDCACHED_ADDRESS -j $JOURNALDIR $OPTS
}

run() {
    export OPTS="-g $OPTS"
    start
}

stop() {
    echo "Stopping..."
    if [ ! -f $PID ]; then
        echo "Already stopped."
    else
        kill `cat $PID`
    fi
}

restart() {
    stop
    start
}

status() {
    if [ ! -f $PID ]; then
        echo "not running"
    else
        echo "program running; pid=`cat $PID`"
    fi
}

usage() {
    echo "Usage: zenrrdcache [run|start|restart|stop|status] [options]"
}


ACTION=$1
shift
export OPTS="$@"
mkdir -p $JOURNALDIR
$ACTION || usage
