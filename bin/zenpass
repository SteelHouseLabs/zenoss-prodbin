#!/bin/bash

cd $ZENHOME

echo -n 'Password for the Zenoss "admin" user: '
stty -echo
read ZOPEPASSWORD
echo
stty echo

test -z "$ZOPEHOME" && export ZOPEHOME=$ZENHOME

$ZOPEHOME/bin/zpasswd.py -u admin -p $ZOPEPASSWORD inituser
zopectl stop
zopectl start
sleep 2
for file in zenperfsnmp zenagios zenperfxmlrpc zenprocess
do
    sed -e "s/zopepassword.*/zopepassword $ZOPEPASSWORD/" < \
        $ZENHOME/etc/${file}.conf > /tmp/${file}.conf
    mv /tmp/${file}.conf $ZENHOME/etc
    $file restart
done
