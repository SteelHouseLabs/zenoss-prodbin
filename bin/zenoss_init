#! /usr/bin/env bash

#
# zenoss_init      A script that performs the initialization required for zenoss
#
# description: Zenoss is a monitoring program written by Zenoss, Inc.

# environment variables
export OS_USERNAME="**OS_USERNAME**"
export ZENHOME="**ZENHOME**"
export MYSQLUSER="**MYSQL_USERNAME**"
export MYSQLPASS="**MYSQL_PASSWD**"
export MYSQLEVENTDB="**MYSQL_DATABASE**"
export ZOPEPASSWORD="**ZOPE_PASSWD**"
export ZOPEHOME=${ZENHOME}

# load the installation functions
. ${ZENHOME}/bin/shared-functions.sh
. ${ZENHOME}/bin/install-functions.sh

# create the log directory
mkdir -p ${ZENHOME}/log

# restart snmpd
restart_snmpd

# create the events mysql database
create_database

# populate the events database
run_zeneventbuild

# set up the zope instance
run_mkzopeinstance

# create the zeodb instance
run_mkzeoinstance

# create the zeo database
start_zeodb
sudo chown -R ${OS_USERNAME} ${ZENHOME}/var
run_zenbuild
stop_zeodb
