#! /usr/bin/env bash

if [ "$ZENHOME" = "" ]; then 
    echo ERROR: ZENHOME envrionment variable not set.
    exit 1
fi

EVTDB=$ZENHOME/Products/ZenEvents/db

if [ -d $EVTDB ]; then 
    cd $EVTDB
else
    echo ERROR: $EVTDB not installed. 
    exit 1
fi

# Create the database
echo "creating database" >&2
mysql -u $1 --password=$2 << EOF
	CREATE DATABASE IF NOT EXISTS $3;
EOF

# Load schema
echo "loading schema" >&2
mysql -u $1 --password=$2 $3 < zenevents.sql

# Load stored procedures
echo "loading stored procedures" >&2
mysql -u $1 --password=$2 $3 < zenprocs.sql
echo "events database created and loaded" >&2
