#!/usr/bin/env python
#############################################################################
# This program is part of Zenoss Core, an open source monitoring platform.
# Copyright (C) 2012, Zenoss Inc.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 as published by
# the Free Software Foundation.
#
# For complete information please visit: http://www.zenoss.com/oss/
#############################################################################

import urllib2
import json
import Globals
from Products.ZenUtils.Utils import unused
from Products.ZenUtils.GlobalConfig import getGlobalConfiguration

unused(Globals)

def gen_stats():
    config = getGlobalConfiguration()
    unused(config)
    url = "{config[zep-uri]}/zeneventserver/api/1.0/stats".format(**locals())
    headers = {'content-type' : 'application/json'}
    req = urllib2.Request(url, headers=headers)
    res = urllib2.urlopen(req)
    stats = json.load(res)["stats"]
    for stat in stats:
        yield "{stat[name]}={stat[value]}".format(**locals())

def main():
    print " ".join(gen_stats())

if __name__ == '__main__':
    main()
