<!--
###########################################################################
#
# This program is part of Zenoss Core, an open source monitoring platform.
# Copyright (C) 2009, Zenoss Inc.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 as published by
# the Free Software Foundation.
#
# For complete information please visit: http://www.zenoss.com/oss/
#
###########################################################################
-->

<tal:block metal:use-macro="context/page_macros/base-new">

<tal:block metal:fill-slot="center_panel">
<div id="master_panel"> </div>
<div id="detail_panel"> </div>
</tal:block>

<tal:block metal:fill-slot="script_layout">
<script>
Ext.onReady(function(){

var treesm = new Ext.tree.DefaultSelectionModel({
    listeners: {
        'selectionchange': function(sm, newnode, oldnode){
            Ext.getCmp('device_grid').setContext(newnode.attributes.uid);
        }
    }
});

var devtree = {
    xtype: 'HierarchyTreePanel',
    id: 'devices',
    searchField: true,
    directFn: Zenoss.remote.DeviceRouter.getTree,
    root: 'Devices',
    rootuid: '/zport/dmd/Devices',
    selModel: treesm
};

var grouptree = {
    xtype: 'HierarchyTreePanel',
    id: 'groups',
    searchField: false,
    directFn: Zenoss.remote.DeviceRouter.getTree,
    root: 'Groups',
    rootuid: '/zport/dmd/Groups',
    selModel: treesm
};

var loctree = {
    xtype: 'HierarchyTreePanel',
    id: 'locs',
    searchField: false,
    directFn: Zenoss.remote.DeviceRouter.getTree,
    root: 'Locations',
    rootuid: '/zport/dmd/Locations',
    selModel: treesm
};

var treecontainer = {
    items: [devtree, grouptree, loctree],
    autoScroll: true
};

Ext.getCmp('center_panel').add({
    id: 'center_panel_container',
    layout: 'border',
    defaults: {
        'border': false
    },
    items: [{
        id: 'master_panel',
        contentEl: 'master_panel',
        layout: 'fit',
        region: 'west',
        split: true,
        width: 275,
        items: [treecontainer]
    },{
        id: 'detail_panel',
        contentEl: 'detail_panel',
        region: 'center',
        layout: 'card',
        activeItem: 0,
        split: true,
        items: [{
            xtype: 'DeviceGridPanel',
            id: 'device_grid'
        }]
    }]
});


});
</script>
</tal:block>
</tal:block> <!-- metal:use-macro="context/page_macros/masterdetailsplit2" -->
