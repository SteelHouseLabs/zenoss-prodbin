<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">
<span metal:define-macro="body">
<script type="text/javascript">	var djConfig = { isDebug: true }; </script>
<script type="text/javascript" src="/zport/js/zenutils.js"></script>
<script type="text/javascript" 
        src="/zport/portal_skins/zenevents/zeneventsfuncs.js"></script>
<script type="text/javascript" src="/zport/portal_skins/zenmodel/datePicker.js">
</script>
<script type="text/javascript">
function datePickerClosed(targetInput) {
    if (targetInput.name == "startdate") {
        startdate = targetInput.value;
        enddateInput = targetInput.form.enddate;
    } else {
        startdate = targetInput.form.startdate.value;
        enddateInput = targetInput;
    } 
    var sdate = getFieldDate(startdate);
    var edate = getFieldDate(enddateInput.value);
    if (sdate.getTime() + 86400000 >= edate.getTime()) {
        edate = new Date(sdate.getTime() + 86400000);
        enddateInput.value = getDateString(edate);
    }
    return true;
};
</script>
<script>
function goExport(url) {
	var sev = document.getElementById("severity").value;
	var state = document.getElementById("state").value;
	var filter = document.getElementById("filter").value;
	var startdate = document.getElementById("startdate").value;
	var enddate = document.getElementById("enddate").value;
	url = url + "/exportEvents?state=" + state + "&severity=" + sev + "&filter=" + filter + "&startdate=" + startdate + "&enddate=" + enddate;
	parent.location = url;
}
</script>

<form method="post" tal:attributes="action here/absolute_url_path"
    tal:define="
    whereclause request/ev_whereclause | here/eventWhere | string:;
    orderby request/ev_orderby | here/eventOrderby | string:;
    resultFields request/ev_resultfields | here/getHistResultFields |
                    here/ZenEventHistory/defaultResultFields;
    evcontrol here/ZenEventHistory/eventControls;
    evcolspan python:len(resultFields)+2;
    severity request/severity | python:0;
    state request/state | python:2;
    sortedHeader request/sortedHeader | string:;
    page string:getHistoryEventListPage;
    ">
<table class="zentable" cellpadding="3" cellspacing="1">
    <input type='hidden' name='table' value='history'/>
    <tr class=tableheader>
    <td>Start Date: 
    <input class="tableheader" type="text" name="startdate" id="startdate"
		readonly="true"
        tal:attributes="value here/yesterdayDate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('startdate');"/>
    </td>
    <td>End Date: 
    <input class="tableheader" type="text" name="enddate" id="enddate"
		readonly="true"
        tal:attributes="value here/todayDate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('enddate');" />
    </td>
    <td>
    <input class="tableheader" type="submit" name="search" value=" Search " 
        onclick="getTablePage(this.form);return false;"/>
    </td>
    </tr>
</table>

<span metal:use-macro="here/templates/macros/contentSeparator"/>

<table class="zentable" cellpadding="3" cellspacing="1">
    <tal:block metal:use-macro="here/viewEvents/macros/header"/>
    <tbody id="eventsBody">
        <span metal:use-macro="here/getHistoryEventListPage/macros/page"/>
    </tbody>
    <tal:block metal:define-macro="histeditor">
        <tr tal:condition="here/isManager">
            <td class="tableheader" tal:attributes="colspan evcolspan">
                <input class="tableheader" type="submit" value="Undelete"
                    name="manage_undeleteEvents:method"/>
                |
                <input class="tableheader" type="submit" value="Map:"
                    name="manage_createEventMap:method"/>
                <select class="tableheader" name="eventClass"
                tal:define="orgs here/Events/getOrganizerNames">
                    <option value=""></option>
                    <option tal:repeat="org orgs" tal:content="org"
                        tal:attributes="value org">/App/Start</option>
                </select>
                |
                <input class="tableheader" type="submit"
                    name="SelectButton" value="Select All"
                    onClick="toggleSelect(this.form); return false"/>
                |
                <input class="tableheader" type="button"
                    name="export" value="Export All"
                    tal:define="severity request/severity | string:2;
                                state request/state | string:1;
                                filter request/filter | string:;"
                    tal:attributes="onClick string:goExport('${request/URL1}');"
                />
            </td>
        </tr>
    </tal:block>
</table>
</form>
</span>
</tal:block>
</tal:block>
