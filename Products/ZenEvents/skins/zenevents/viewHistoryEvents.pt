<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">

<span metal:define-macro="body">
<link type="text/css" rel="stylesheet" href="css/zengrid.css"/>
<script type="text/javascript">	var djConfig = { isDebug: true }; </script>
<script type="text/javascript" src="/zport/js/zenutils.js"></script>
<script type="text/javascript" src="/zport/javascript/zengrid.js"></script>
<script type="text/javascript" 
        src="/zport/portal_skins/zenevents/zeneventsfuncs.js"></script>
<script type="text/javascript" src="/zport/portal_skins/zenmodel/datePicker.js">
</script>

<form method="post" tal:attributes="action here/absolute_url_path"
      name="history_events"
    tal:define="
    whereclause request/ev_whereclause | here/eventWhere | string:;
    orderby request/ev_orderby | here/eventOrderby | string:;
    resultFields request/ev_resultfields | here/getHistResultFields |
                    here/ZenEventHistory/defaultResultFields;
    evcontrol here/ZenEventHistory/eventControls;
    evcolspan python:len(resultFields)+2;
    severity request/severity | python:0;
    state request/state | python:2;
    sortedHeader request/sortedHeader | string:;
    page string:getHistoryEventListPage;
    ">

<input type='hidden' name='zenScreenName' tal:attributes="value template/id" />
<div style="padding:8px;margin:10px;background-color:darkgrey;
       text-align:center;border:1px solid black" id="histcontrolholder">
    <label for="startdate">Start:</label>
    <input class="tableheader" type="text" name="startdate" id="startdate"
		readonly="true" style="width:10em;"
        tal:attributes="value here/yesterdayDate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('startdate');"/>
    <label for="enddate">End:</label>
    <input class="tableheader" type="text" name="enddate" id="enddate"
		readonly="true"
        tal:attributes="value here/todayDate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('enddate');" />
            <label for="severity"> Severity:</label>
            <select class="tableheader" name="severity:int" id="severity">
                <option tal:repeat="sev here/ZenEventManager/getSeverities"
                    tal:content="python:sev[0]"
                    tal:attributes="value python:sev[1]; 
                                    selected python:sev[1]==severity" />
            </select>
            &nbsp; &nbsp;
            <label for="state">State:</label>
            <select class="tableheader" name="state:int" id="state">
                <option tal:repeat="st here/ZenEventManager/getEventStates"
                    tal:content="python:st[0]"
                    tal:attributes="value python:st[1]; 
                                    selected python:st[1]==state" />
            </select>
</div>

<tal:block tal:define="
tabletitle string:;
menu_id string:HistoryEvent_list;
                      ">
<tal:block metal:use-macro="here/zenuimacros/macros/zentable">

<tal:block metal:fill-slot="filterslot">

<div class="filterbox">
<input type="text" name="filter" id="filter"
    onfocus="select(this)"
    tal:attributes="value ts/filter | string:;"/>
</div>
</tal:block>

<tal:block metal:fill-slot="zentablecontents">

<tr><td>


<div id="gridcontainer" style="width:100%;">

</div>

<script tal:content="string:
var eventZenGridBuffer, eventZenGrid;
addLoadEvent( function() {
    eventZenGridBuffer = new ZenGridBuffer();
    eventZenGrid = new ZenGrid('gridcontainer', 
        'getJSONHistoryEventsInfo', 'mygrid', eventZenGridBuffer,
        '${here/absolute_url_path}', 1 );
    connect('filter', 'onkeyup', eventZenGrid.doEventLivesearch);
    connect('state', 'onchange', eventZenGrid.refreshFromFormElement);
    connect('severity', 'onchange', eventZenGrid.refreshFromFormElement);
});">
</script>

<script type="text/javascript">
function datePickerClosed(targetInput) {
    if (targetInput.name == "startdate") {
        startdate = targetInput.value;
        enddateInput = targetInput.form.enddate;
    } else {
        startdate = targetInput.form.startdate.value;
        enddateInput = targetInput;
    } 
    var sdate = getFieldDate(startdate);
    var edate = getFieldDate(enddateInput.value);
    if (sdate.getTime() + 86400000 >= edate.getTime()) {
        edate = new Date(sdate.getTime() + 86400000);
        enddateInput.value = getDateString(edate);
    }
    eventZenGrid.refreshWithParams({
        startdate:$('startdate').value,
        enddate:$('enddate').value
    });
    return true;

};
</script>

</td></tr>
<!-- END TABLE CONTENTS -->

</tal:block>
</tal:block>
</tal:block>



</form>
</span>
</tal:block>
</tal:block>
