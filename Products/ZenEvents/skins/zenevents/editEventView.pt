<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">
<form id='clauseForm' method="post" tal:attributes="action here/absolute_url_path">
<input type="hidden" name="zenScreenName" tal:attributes="value template/id"/>
<table class="zentable"  cellpadding="3" cellspacing="1">
<tr tal:define="message request/message | string:State at time:">
    <th class=tabletitle colspan="2"
        tal:content="string:${message} ${here/getNowString}" />
</tr>
<tr>
  <td class="tableheader">Type</td>
  <td class="tablevalues">
    <select class="tablevalues" name="type">
        <option tal:repeat="t here/evtypes" tal:content="t"
                tal:attributes="value t; selected python:t==here.type"/>
    </select>
  </td>
</tr>

<tr>
  <td class="tableheader">Where</td>
  <td class="tablevalues" colspan="2">
  <script type="text/javascript" src="/zport/js/query.js"></script>
    <span id="query"><span id="filters">
      <table summary="Action filters"><tbody>
	  <tr><td colspan='4'>
	     <label for="add_filter" class="tablevalues">Add filter</label>&nbsp;
	     <select name="add_filter" id="add_filter" class="tablevalues"
	       tal:content='structure here/getQueryElements'/>
	     <input type="submit" name="add" value="+" class="tablevalues"/>
	   </td></tr>
       </tbody></table>
    </span></span>
  </td>
</tr>
<noscript>
  <tr><td colspan="6"><b>Unable to use javascript:</b><td></tr>
  <tr>
    <td class="tablevalues" colspan="2">
      <textarea class="tablevalues" rows="6" cols="75" name="where"
          tal:content="here/getWhere"/>
    </td>
  </tr>
</noscript>

<tr>
  <td class="tableheader">Order by</td>
  <td class="tablevalues">
    <input class="tablevalues" type="text" name="orderby" size="60"
        tal:attributes="value here/getOrderBy" />
  </td>
</tr>
<tr>
<td class="tableheader">Result Fields</td>
<td class="tablevalues">
<tal:block tal:condition="python:'MSIE' in here.REQUEST.HTTP_USER_AGENT">
    <select multiple size=10 class="tablevalues" name="resultFields:list">
         <option tal:repeat="field here/ZenEventManager/getFieldList"
             tal:content="python:field"
             tal:attributes="value python:field;
                 selected python:field in here.getResultFields()" />
     </select>
</tal:block>
<tal:block tal:condition="python:'MSIE' not in here.REQUEST.HTTP_USER_AGENT">
<script src="/zport/js/MochiKit.js"></script>
<script src="/zport/js/DragAndDrop.js"></script>
<script src="/zport/js/Sortable.js"></script>
<script src="zendragdrop.js"></script>

        <div style="float:left;">
                   <textarea tal:content="python:'\n'.join(here.resultFields)"
                      name="resultFields:lines"
                      id="ta_resultFields"></textarea>
        <h5>Fields (drag to change order)</h5>

        </div>
        <div style="float:left;">
            <ul id="ul_resultFields"
                class="sortable_list fieldlist">
                <li 
                class="sortable_item fieldlist"
                tal:repeat="field python:[x for x in here.ZenEventManager.getFieldList() 
                            if x not in here.resultFields]"
                    tal:content="field">item</li>
            </ul>
        <h5>Available fields (drag to other list to add)</h5>
        </div>
            <script> var x = new ZenDragDropList('ta_resultFields',
                                                 'ul_resultFields');
            </script>

</tal:block>
</td>
</tr>
<tr>
    <td class="tableheader" colspan="2">
        <input class="tableheader" type="submit" value=" Save "
            name="manage_editEventView:method" />
    </td>
</tr>
</table>
</form>

<script tal:content="structure here/getWhereClauseAsJavaScript" type="text/javascript"/>

</tal:block>
</tal:block>
