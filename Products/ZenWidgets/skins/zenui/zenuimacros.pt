<tal:block metal:define-macro="basemenu"
    tal:condition="python:hasattr(here, 'getMenus')">
<link href="css/menus.css" rel="stylesheet" type="text/css" />

<div class="menu" tal:define="
        menu_ids menu_ids | python:['Edit','Actions'];
        basepath here/absolute_url_path"
        tal:condition="python:here.getMenus(menu_ids)">
<div tal:attributes="id string:contextmenu_btn">
    <a class="tabletitle">&nbsp;</a>
</div>

<div style="position:absolute;" class="invisible" id="contextmenu_items">
<div class="menu_top">&nbsp;</div>
<div class="menu_bottom">&nbsp;</div>
<ul class="zenMenu">
<tal:block tal:repeat="menu menu_ids">
<li tal:condition="python:here.getMenus(menu, here)">
<a href="javascript:void(0)" tal:attributes="id string:${menu}_parent">
<tal:block tal:content="menu">
Menu
</tal:block>
</a>
<div class="submenu" tal:attributes="id string:${menu}_submenu">
    <div class="menu_top_rounded">&nbsp;</div>
    <div class="menu_bottom">&nbsp;</div>
    <ul>
    <li tal:repeat="item python:here.getMenus(menu, here)">
    <a tal:define="mypath python:test(item.action.startswith('javascript'),
                                item.action,
                                '%s/%s' % (basepath, item.action));
                   actionpath python:test(item.isdialog, 
                    'javascript:$(\'dialog\').show(this.event, \'%s\')' % mypath,
                    mypath)"
       tal:attributes="href actionpath" 
       tal:content="item/description">description</a>
    </li>
    </ul>
</div>
<script tal:content="string:
    registerSubmenu('${menu}_parent','${menu}_submenu');">javascript madness
</script>
</li>
</tal:block>
<tal:block metal:use-macro="here/userCommandsMacros/macros/runCommandMenu"/>
</ul>
</div>
</div>
<script tal:content="string:
    var cxmto;
    if ( $$('contextmenu_btn') ) {
    var hidectxmenu = function() { 
        removeElementClass('contextmenu_btn','menuselected');
        makeInvisible('contextmenu_items') }
    connect('contextmenu_btn','onclick',function() {
        clearTimeout(cxmto);
        makeVisible('contextmenu_items');
        addElementClass('contextmenu_btn','menuselected');});
    connect('contextmenu_items', 'onmouseout',function() {
        cxmto = setTimeout('hidectxmenu()', 500); });
    connect('contextmenu_btn', 'onmouseout',function() {
        cxmto = setTimeout('hidectxmenu()', 500); });
    connect('contextmenu_items','onmouseover',function() {
        clearTimeout(cxmto);
        addElementClass('contextmenu_btn','menuselected');
        makeVisible('contextmenu_items'); });
    connect('contextmenu_items','onclick',function() {
        makeInvisible('contextmenu_items');
    });
    }
">
</script>

</tal:block>


<tal:block metal:define-macro="contextmenu"
    tal:condition="python:hasattr(here, 'getMenus')"
    tal:define="menu_id string:Context">

<link href="css/menus.css" rel="stylesheet" type="text/css" />

<div class="contextmenu" tal:attributes="id menu_id"
    tal:define="menuitems python:here.getMenus(menu_id, here);
                basepath here/absolute_url_path"
    tal:condition="menuitems">

        <div tal:attributes="id string:${menu_id}_btn">
        <a class="tabletitle">&nbsp;</a>
        </div>

        <div class="contextmenuitems invisible"
            tal:attributes="id string:${menu_id}_items">
        <div class="menu_top">&nbsp;</div>
        <div class="menu_bottom">&nbsp;</div>
        <ul class="zenMenu" tal:attributes="id string:${menu_id}_list">
            <li tal:repeat="i menuitems">
                <a tal:attributes="href string:${basepath}/${i/action}"
                   tal:content="i/description">description</a>
            </li>
        </ul>
        </div>

        <script tal:content="string:
            connect('${menu_id}_btn','onclick',function() {
                makeVisible('${menu_id}_items');
                addElementClass('${menu_id}_btn','menuselected');});
            connect('${menu_id}_items', 'onmouseout',function() {
                removeElementClass('${menu_id}_btn','menuselected');
                makeInvisible('${menu_id}_items'); });
            connect('${menu_id}_btn', 'onmouseout',function() {
                removeElementClass('${menu_id}_btn','menuselected');
                makeInvisible('${menu_id}_items'); });
            connect('${menu_id}_items','onmouseover',function() {
                addElementClass('${menu_id}_btn','menuselected');
                makeVisible('${menu_id}_items'); });
            connect('${menu_id}_items','onclick',function() {
                makeInvisible('${menu_id}_items');
            });
        ">
        </script>
    </div>
</tal:block>


<!-- TABLE HEADER MACRO -->

<tal:block metal:define-macro="tabletitle">
<th class="tabletitle" tal:attributes="colspan tblcolspan|string:1">
<div class="tabletitlecontainer">
    <div class="leftcorner">&nbsp;</div>
<tal:block metal:define-slot="titleslot">
    <span class="tabletitletext" tal:content="tabletitle | string:Items">
        Title
    </span>
</tal:block>
<tal:block metal:define-slot="filterslot">
    <tal:block tal:condition="showfilterbox | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
    </tal:block>
</tal:block>
<tal:block metal:define-slot="menuslot">
    <tal:block tal:condition="menu_id | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/devmovemenu"/>
    </tal:block>
</tal:block>
    <div class="rightcorner">&nbsp;</div>
</div>
</th>
</tal:block>

<!-- END TABLE HEADER MACRO -->



<!-- FILTERBOX MACRO -->

<tal:block metal:define-macro="filterbox">
<link href="css/filterbox.css" rel="stylesheet" type="text/css" />
<div class="filterbox"
     tal:define=" tableName tableName | nothing;
                 ts python:test(
                  tableName, here.ZenTableManager.getTableState(tableName), 
                  request);
                 message request/SESSION/message | nothing;">
<input type="text" name="filter" id="filter"
    onfocus="select(this)"
    tal:attributes="value ts/filter | string:;
    onkeypress python:test(tableName, 'submitViaEnter(event)',
        'getPageViaEnter(event)' )" />
</div>
</tal:block>

<tal:block metal:define-macro="filterboxinline">
<tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
<style>.filterbox{position:relative;top:0px;
left:0px;right:0px;bottom:0px;display:inline;
padding-right:20px;margin-left:20px;}</style>
</tal:block>

<!-- END FILTERBOX MACRO -->


<tal:block metal:define-macro="devmovemenu">

<link href="css/menus.css" rel="stylesheet" type="text/css" />

<div class="littlemenu" tal:attributes="id menu_id"
    tal:define="menuitems python:here.getMenus(menu_id, here);
                pathtrans here/REQUEST/PATH_TRANSLATED;
                basepath python:test(
                      pathtrans.endswith(template.id),
                      '/'.join(pathtrans.split('/')[:-1]),
                      pathtrans)"
    tal:condition="menuitems">

        <div class="devmovemenu" tal:attributes="id string:${menu_id}_btn">
           &nbsp; 
        </div>

        <div class="devmovemenuitems invisible"
            tal:attributes="id string:${menu_id}_items">
        <div class="menu_top">&nbsp;</div>
        <div class="menu_bottom">&nbsp;</div>
        <ul class="zenMenu" tal:attributes="id string:${menu_id}_list">
            <li tal:repeat="item menuitems">
<tal:block tal:define="
mypath python:test(item.action.startswith('javascript'),
                            item.action,
                            '%s/%s' % (basepath, item.action));
               thisid python:filter(lambda x:x.isalnum(), menu_id+item.id);
               actionpath python:test(item.isdialog, 
                    'javascript:$(\'dialog\').show($(\'%sinput\').form, 
                    \'%s\')' % (thisid,mypath),
               mypath)">
   <input tal:attributes="id string:${thisid}input" type="hidden"/>
   <a tal:attributes="id thisid; href actionpath" 
    tal:content="item/description">description</a>
</tal:block>

            </li>
        </ul>
        </div>

        <script tal:content="string:
            connect('${menu_id}_btn','onclick',function() {
                makeVisible('${menu_id}_items');
                addElementClass('${menu_id}_btn','menuselected');});
            connect('${menu_id}_items', 'onmouseout',function() {
                removeElementClass('${menu_id}_btn','menuselected');
                makeInvisible('${menu_id}_items'); });
            connect('${menu_id}_btn', 'onmouseout',function() {
                removeElementClass('${menu_id}_btn','menuselected');
                makeInvisible('${menu_id}_items'); });
            connect('${menu_id}_items','onmouseover',function() {
                addElementClass('${menu_id}_btn','menuselected');
                makeVisible('${menu_id}_items'); });
            connect('${menu_id}_items','onclick',function() {
                makeInvisible('${menu_id}_items');
            });
        ">
        </script>
    </div>
</tal:block>

<!--===================================
            Zentable macro
====================================-->
<tal:block metal:define-macro="zentable">
    <table class=" zentable">
        <tr tal:define="tabletitle tabletitle|string:">
        <tal:block metal:use-macro="here/zenuimacros/macros/tabletitle">
            <tal:block metal:fill-slot="filterslot">
              <tal:block metal:define-slot="filterslot">
    <tal:block tal:condition="showfilterbox | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
    </tal:block>
              </tal:block>
            </tal:block>
            <tal:block metal:fill-slot="menuslot">
                <tal:block metal:define-slot="menuslot">
    <tal:block tal:condition="menu_id | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/devmovemenu"/>
    </tal:block>
                </tal:block>
            </tal:block>

        </tal:block>
        </tr>
        <tr>
            <td style="padding:0px;">
                <table class="innerzentable" cellpadding="3" cellspacing="1">
<!-- The main body into which we dump rows -->
<tbody tal:attributes="id python:filter(lambda x:x.isalnum(),tabletitle)">
                        <tal:block metal:define-slot="zentablecontents">

                        </tal:block>
</tbody>
<!-- End main row body -->
                    <tal:block metal:define-slot="zentableextra">
                    </tal:block>
                </table>
            </td>
        </tr>
    </table>
</tal:block>


<!--=================================================
    Javascript utilities that are easier with templating
    =================================================-->

<tal:block metal:define-macro="jsutils">
<script tal:content="string:

var submitFormToMethod = function(formname, method) {
//Basically for use in menu items, to obviate creating dummy forms
//or menu items that are actually buttons.
   f = document.forms[formname];
   f.action = '${here/absolute_url_path}/' + method;
   f.submit();
}

var goExport = function() {
    var sev = $('severity')?$('severity').value : '2';
    var state = $('state')?$('state').value : '1';
    var filter = $('filter')?$('filter').value : '';
    var startdate = $('startdate')?$('startdate').value:null;
    var enddate = $('enddate')?$('enddate').value:null;
    url = '${here/absolute_url_path}/'+ 'exportEvents?state=' + state + 
        '&severity=' + sev + '&filter=' + filter;
    if (startdate!=null) url += '&startdate=' + startdate + '&enddate=' + enddate;
    parent.location = url;
}

">s</script>
</tal:block>

