<tal:block metal:define-macro="basemenu"
    tal:condition="python:hasattr(here, 'getMenus')">

<div class="menu" tal:define="
        menu_ids menu_ids | python:['More','Manage','Actions','Add'];
        basepath here/absolute_url_path">
<div tal:attributes="id string:contextmenu_btn">
    <a class="tabletitle">&nbsp;</a>
</div>

<div id="contextmenu_items" class="contextmenuitems">
<div class="menu_top">&nbsp;</div>
<div class="menu_bottom">&nbsp;</div>
<ul class="zenMenu">
<tal:block tal:repeat="menu menu_ids">
<tal:block tal:condition="python:menu != 'TopLevel'" 
        tal:define="menus python:here.getMenus(menu, here)">
<li tal:condition="python:menus and len(menus) > 1">
        <a href="javascript:void(0)" tal:attributes="id string:${menu}_parent">
        <tal:block tal:content="menu">Menu</tal:block>
        </a>
</li>
<div class="submenu" 
        tal:define="items menus"
        tal:condition="menus"
        tal:attributes="id string:${menu}_submenu">
    <tal:block tal:condition="items">
            <tal:block tal:define="dummy items/sort"/>
    </tal:block>
    <div class="menu_top_rounded">&nbsp;</div>
    <div class="menu_bottom">&nbsp;</div>
    <ul>
    <li tal:repeat="item items">
    <a tal:define="mypath python:test(item.action.startswith('javascript'),
                                item.action,
                                '%s/%s' % (basepath, item.action));
                   actionpath python:test(item.isdialog, 
                    'javascript:$(\'dialog\').show(this.event, \'%s\')' % mypath,
                    mypath)"
       tal:attributes="href actionpath" 
       tal:content="item/description">description</a>
       <tal:block tal:condition="python:getattr(request, 'showMenuOrder', None)" 
                  tal:content="item/ordering"/>
    </li>
    </ul>
</div>
<script tal:condition="menus"
tal:content="string:
    registerSubmenu('${menu}_parent','${menu}_submenu');">javascript madness
</script>
</tal:block>
</tal:block>

<tal:block metal:use-macro="here/userCommandsMacros/macros/runCommandMenu"/>

<tal:block tal:repeat="menu menu_ids">
<tal:block tal:condition="python:menu != 'TopLevel'" 
        tal:define="menus python:here.getMenus(menu, here)">
<li tal:condition="python:menus and len(menus) == 1" class="toplevelmenu">
<tal:block tal:define="item python:menus[0]">
    <a tal:define="mypath python:test(item.action.startswith('javascript'),
        item.action,
        '%s/%s' % (basepath, item.action));
        actionpath python:test(item.isdialog, 
        'javascript:$(\'dialog\').show(this.event, \'%s\')' % mypath,
        mypath)"
        tal:attributes="href actionpath" 
        tal:content="item/description">description</a>
     <tal:block tal:condition="python:getattr(request, 'showMenuOrder', None)" 
             tal:content="item/ordering"/>
</tal:block>
</li>
</tal:block>
</tal:block>

<tal:block tal:define="items python:here.getMenus('TopLevel', here)">
<tal:block tal:condition="items">
        <tal:block tal:define="dummy items/sort"/>
</tal:block>
<li tal:repeat="item items" class="toplevelmenu">
    <a tal:define="mypath python:test(item.action.startswith('javascript'),
        item.action,
        '%s/%s' % (basepath, item.action));
        actionpath python:test(item.isdialog, 
        'javascript:$(\'dialog\').show(this.event, \'%s\')' % mypath,
        mypath)"
        tal:attributes="href actionpath" 
        tal:content="item/description">description</a>
    <tal:block tal:condition="python:getattr(request, 'showMenuOrder', None)" 
            tal:content="item/ordering"/>
</li>
</tal:block>

</ul>
</div>
</div>
<script>
registerMenu('contextmenu_btn', 'contextmenu_items');
</script>
</tal:block>

<!-- TABLE HEADER MACRO -->

<tal:block metal:define-macro="tabletitle">
<th class="tabletitle" tal:attributes="colspan tblcolspan|string:1">
<div class="tabletitlecontainer">
    <div class="leftcorner">
<tal:block metal:define-slot="menuslot">
    <tal:block tal:condition="menu_id | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/devmovemenu"/>
    </tal:block>
</tal:block>
</div>
<tal:block metal:define-slot="titleslot">
    <span class="tabletitletext" tal:content="tabletitle | string:Items">
        Title
    </span>
</tal:block>
<tal:block metal:define-slot="filterslot">
    <tal:block tal:condition="showfilterbox | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
    </tal:block>
</tal:block>
    <div class="rightcorner">&nbsp;</div>
</div>
</th>
</tal:block>

<!-- END TABLE HEADER MACRO -->



<!-- FILTERBOX MACRO -->

<tal:block metal:define-macro="filterbox">
<div class="filterbox"
     tal:define=" tableName tableName | nothing;
                 ts python:test(
                  tableName, here.ZenTableManager.getTableState(tableName), 
                  request);
                 message request/SESSION/message | nothing;">
<input type="text" name="filter" id="filter"
    onfocus="select(this)"
    tal:attributes="value ts/filter | string:;
    onkeypress string:submitViaEnter(event)" />
</div>
</tal:block>

<tal:block metal:define-macro="filterboxinline">
<tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
<style>.filterbox{position:relative;top:0px;
left:0px;right:0px;bottom:0px;display:inline;
padding-right:20px;margin-left:20px;}</style>
</tal:block>

<!-- END FILTERBOX MACRO -->


<tal:block metal:define-macro="devmovemenu">

<tal:block tal:condition="python:hasattr(here, 'getMenus')">
<div class="littlemenu" tal:attributes="id menu_id"
    tal:define="menuitems python:here.getMenus(menu_id, here);
                pathtrans here/absolute_url_path;
                basepath python:test(
                      pathtrans.endswith(template.id),
                      '/'.join(pathtrans.split('/')[:-1]),
                      pathtrans)"
    tal:condition="menuitems">

        <tal:block tal:condition="menuitems">
                <tal:block tal:define="dummy menuitems/sort"/>
        </tal:block>

        <div class="devmovemenu" tal:attributes="id string:${menu_id}_btn">
           &nbsp; 
        </div>

        <div class="devmovemenuitems"
            tal:attributes="id string:${menu_id}_items">
        <div class="menu_top">&nbsp;</div>
        <div class="menu_bottom">&nbsp;</div>
        <ul class="zenMenu" tal:attributes="id string:${menu_id}_list">
            <li tal:repeat="item menuitems">
<tal:block tal:define="
mypath python:test(item.action.startswith('javascript'),
                            item.action,
                            '%s/%s' % (basepath, item.action));
               thisid python:filter(lambda x:x.isalnum(), menu_id+item.id);
               actionpath python:test(item.isdialog, 
                    'javascript:$(\'dialog\').show($(\'%sinput\').form, 
                    \'%s\')' % (thisid,mypath),
               mypath)">
   <input tal:attributes="id string:${thisid}input" type="hidden"/>
   <a tal:attributes="id thisid; href actionpath" 
    tal:content="item/description">description</a>
   <tal:block tal:condition="python:getattr(request, 'showMenuOrder', None)" 
              tal:content="item/ordering"/>
</tal:block>

            </li>
        </ul>
        </div>

        <script tal:content="string:
            registerMenu('${menu_id}_btn', '${menu_id}_items');
        ">
        </script>
    </div>
</tal:block>
</tal:block>

<!--===================================
            Zentable macro
====================================-->
<tal:block metal:define-macro="zentable">
    <table class=" zentable">
        <tr tal:define="tabletitle tabletitle|string:">
        <tal:block metal:use-macro="here/zenuimacros/macros/tabletitle">
            <tal:block metal:fill-slot="filterslot">
              <tal:block metal:define-slot="filterslot">
    <tal:block tal:condition="showfilterbox | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/filterbox"/>
    </tal:block>
              </tal:block>
            </tal:block>
            <tal:block metal:fill-slot="menuslot">
                <tal:block metal:define-slot="menuslot">
    <tal:block tal:condition="menu_id | python:False">
        <tal:block metal:use-macro="here/zenuimacros/macros/devmovemenu"/>
    </tal:block>
                </tal:block>
            </tal:block>

        </tal:block>
        </tr>
        <tr>
            <td style="padding:0px;">
                <table class="innerzentable" cellpadding="3" cellspacing="1">
<!-- The main body into which we dump rows -->
<tbody tal:attributes="id python:filter(lambda x:x.isalnum(),tabletitle)">
                        <tal:block metal:define-slot="zentablecontents">

                        </tal:block>
</tbody>
<!-- End main row body -->
                    <tal:block metal:define-slot="zentableextra">
                    </tal:block>
                </table>
            </td>
        </tr>
    </table>
</tal:block>


<!--=================================================
    Javascript utilities that are easier with templating
    =================================================-->

<tal:block metal:define-macro="jsutils">
<script tal:content="string:

var submitFormToMethod = function(formname, method) {
//Basically for use in menu items, to obviate creating dummy forms
//or menu items that are actually buttons.
   f = document.forms[formname];
   f.action = '${here/absolute_url_path}/' + method;
   f.submit();
}

var goExport = function() {
    var params = {};
    if (eventZenGrid.lastparams['severity'])
        params['sev'] = eventZenGrid.lastparams['severity'];
    if (eventZenGrid.lastparams['state'])
        params['state'] = eventZenGrid.lastparams['state'];
    if (eventZenGrid.lastparams['filter'])
        params['filter'] = eventZenGrid.lastparams['filter'];
    if (eventZenGrid.lastparams['startdate'])
        params['startdate'] = eventZenGrid.lastparams['startdate'];
    if (eventZenGrid.lastparams['enddate'])
        params['enddate'] = eventZenGrid.lastparams['enddate'];
    if (eventZenGrid.lastparams['orderby'])
        params['orderby'] = eventZenGrid.lastparams['orderby'];
    log(keys(params));
    log(queryString(params));
    url = '${here/absolute_url_path}/exportEvents?' + queryString(params);
    parent.location = url;
}

">s</script>
</tal:block>

