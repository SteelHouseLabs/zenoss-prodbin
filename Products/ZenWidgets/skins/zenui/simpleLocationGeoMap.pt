<html><body>
<script type="text/javascript" src="js/MochiKit.js"></script>
<script> var YAHOO_config={load:{base: '/zport/dmd/yui/'}};</script>
<script src="/zport/dmd/yui/yuiloader/yuiloader-min.js"></script>
<script src="/zport/dmd/yui/yahoo/yahoo-min.js"></script>
<script src="/zport/dmd/javascript/zenoss-core.js"></script>
<link type="text/css" rel="stylesheet" href='css/zenoss.css'/>
<link type="text/css" rel="stylesheet" href='css/geomap.css'/>
<style>
body {margin:0;padding:0;background-color:#bbb}
div#geomapcontainer { margin:0;padding:0;border:medium none; }
</style>
<style type="text/css">
v\:* {
  behavior:url(#default#VML);
}
</style>

    <link type="text/css" rel="stylesheet" href='css/geomap.css'/>
    <style type="text/css">
    v\:* {
      behavior:url(#default#VML);
    }
    </style>
<tal:block tal:condition="here/dmd/geomapapikey">
    <script type="text/javascript"
        tal:condition="here/dmd/geomapapikey"
        tal:define="apikey here/dmd/geomapapikey"
        tal:attributes="
            src string:http://maps.google.com/maps?file=api&v=2&key=${apikey};
    "></script>
    <script tal:content="string:
        var eventsdb=true,
            nodedata = ${here/getChildGeomapData},
            linkdata = ${here/getChildLinks},
            geocodecache = ${here/dmd/getGeoCache};
    " tal:on-error="string:var eventsdb=false;"></script>
<script>
var IS_MAP_PORTLET = true;
(function(){ // Private namespace

function maximizeMapHeight() {
    mapdiv = $('geomapcontainer');
    mapoffset = getElementPosition(mapdiv).y;
    maxbottom = getViewportDimensions().h;
    newdims = {'h':maxbottom-mapoffset};
    setElementDimensions(mapdiv, newdims);
}

connect(currentWindow(), 'onresize', maximizeMapHeight);

addLoadEvent(maximizeMapHeight);

if (eventsdb /* eventsdb is defined above */) {
    loader = YAHOO.zenoss.getLoader();
    loader.require(['geomap']);
    loader.insert({onSuccess:function(){
            YAHOO.zenoss.geomap.initialize('geomapcontainer')}
    });
}

})(); // End private namespace
</script>
</tal:block>


<div id="geomapcontainer" tal:define="dummy here/getChildGeomapData"
    tal:on-error="structure python:here.dmd.error_handler(error)">

    <!-- Google Maps javascript adds map here -->

    <div tal:condition="python:not here.dmd.geomapapikey" id="geomaperrormsg">
        You haven't yet specified a Google Maps API key. <br/>
        Please go to the 
        <a href="/zport/dmd/editSettings"
           onclick="currentWindow().parent.location.href=this.href">Settings</a> 
        page to set one up.
    </div>

</div></body></html>
