<tal:block metal:use-macro="here/templates/macros/page2">

<tal:block metal:fill-slot="head-local">
    <link type="text/css" rel="stylesheet" href='css/geomap.css'/>
    <style type="text/css">
    v\:* {
      behavior:url(#default#VML);
    }
    </style>
<tal:block tal:condition="here/dmd/geomapapikey">
    <script type="text/javascript"
        tal:condition="here/dmd/geomapapikey"
        tal:define="apikey here/dmd/geomapapikey"
        tal:attributes="
            src string:http://maps.google.com/maps?oe=utf8&file=api&v=2&key=${apikey};
    "></script>
    <script tal:content="string:
        var eventsdb=true,
            nodedata = ${here/getChildGeomapData},
            linkdata = ${here/getChildLinks},
            geocodecache = ${here/dmd/getGeoCache};
    " tal:on-error="string:var eventsdb=false;"></script>
<script>
(function(){ // Private namespace

function maximizeMapHeight() {
    mapdiv = $('geomapcontainer');
    mapoffset = getElementPosition(mapdiv).y;
    maxbottom = getViewportDimensions().h;
    newdims = {'h':maxbottom-mapoffset-20};
    setElementDimensions(mapdiv, newdims);
}

connect(currentWindow(), 'onresize', maximizeMapHeight);

addLoadEvent(maximizeMapHeight);

if (eventsdb /* eventsdb is defined above */) {
    loader = YAHOO.zenoss.getLoader();
    loader.require(['geomap']);
    loader.insert({onSuccess:function(){
            YAHOO.zenoss.geomap.initialize('geomapcontainer')}
    });
}

})(); // End private namespace
</script>
</tal:block>
</tal:block>

<tal:block metal:fill-slot="breadCrumbPane">
    /<a tal:attributes="
        href string:${here/absolute_url_path}/${template/id}">Location Map
    </a>
</tal:block>

<tal:block metal:fill-slot="contentPane">

<div id="geomapcontainer" tal:define="dummy here/getChildGeomapData"
    tal:on-error="structure python:here.dmd.error_handler(error)">

    <!-- Google Maps javascript adds map here -->

    <div tal:condition="python:not here.dmd.geomapapikey" id="geomaperrormsg">
        You haven't yet specified a Google Maps API key. <br/>
        Please go to the 
        <a href="/zport/dmd/editSettings">Settings</a> 
        page to set one up.
    </div>

</div>
</tal:block>

</tal:block>

