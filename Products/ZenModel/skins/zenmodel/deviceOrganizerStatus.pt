<tal:comment replace="nothing">
<!-- ========================================================
    This page is used as the default view for Devices
    and Device collections (e.g. Locations, Groups, etc).
 ======================================================== -->
</tal:comment>

<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">
    <!-- Status Table -->
    <table class="zentable"  cellpadding="3" cellspacing="1"
        metal:define-macro="status">
        <tr>
          <th class="tabletitle" align="left" colspan="6">Summary</th>
        </tr>
        <tr>
          <td class="tableheader" align="left">Events</td>
          <td class="tablevalues" align="left">
            <table metal:use-macro="here/deviceStatus/macros/eventrainbow" />
          </td>
          <th class="tableheader" align="left">Sub Count</th>
          <td class="tablevalues" tal:content="here/countChildren">100</td>
          <th class="tableheader" align="left">Device Count</th>
          <td class="tablevalues" tal:content="here/countDevices">100</td>
        </tr>
    </table>

    <span metal:use-macro="here/templates/macros/contentSeparator"/>

<form method="post" tal:attributes="action here/absolute_url_path">
<input type="hidden" name="zenScreenName" value="deviceOrganizerStatus" />
<script language="javascript">

function toggleElement(elementid) {
    var element = $(elementid);
    if (element.visible == 0) {
        element.style.display = "none";
        element.visible = 1;
    } else {
        element.style.display = "";
        element.visible = 0;
    }
}
</script>
<table class="zentable" cellpadding="3" cellspacing="1"
    tal:condition="python:here.id != here.dmdRootName">
    <tbody>
    <tr>
        <th class="tabletitle" colspan="3" tal:content="python:here.dmdRootName[:-1]"/>
    </tr>
    <tr>
        <td class="tableheader" style="width:20em;" >Name</td>
        <td class="tablevalues" 
            tal:content="string:${here/id}"/>
    </tr>
    <tr>
        <td class="tableheader">Description</td>
        <td class="tablevalues">
        <span
            tal:content="structure python:here.description.replace('\n','<br/>')"/>
            <br tal:condition="here/description"  />
        <span tal:condition="here/isManager"> 
            <a style="color:darkgrey;text-decoration:none;"
               href="javascript:toggleElement('descriptioneditform')">[Edit]</a>
        </span>
    </tr>
    </tbody>
    <tbody id="descriptioneditform" tal:condition="here/isManager" 
            visible="1" style="display:none;">
    <tr>
        <td class="tableheader">New Description</td>
        <td class="tablevalues"> 
            <textarea tal:condition="here/isManager" name="description"
                    rows="4" cols="50" tal:content="here/description"/>
            <tal:block tal:condition="not: here/isManager"
                    tal:replace="here/description" />
    </tr>
    <tr>
        <td class="tableheader" align="left">
        </td>
        <td align="left" class="tableheader">
            <input class="tableheader" type="submit" value=" Save "
                name="zmanage_editProperties:method:method" />
            <input class="tableheader" type="button" value=" Cancel "
                onclick="javascript:toggleElement('descriptioneditform')"/>
        </td>
    </tr>
    </tbody>
</table>
</form>

<tal:block tal:condition="python:here.id != here.dmdRootName">
    <span metal:use-macro="here/templates/macros/contentSeparator"/>
</tal:block>

    <!-- Sub-Devices Table -->
    <form method="post" tal:attributes="action here/absolute_url_path">
    <table class="zentable" cellpadding="3" cellspacing="1"
            tal:define="objects here/children;
            tableName string:children;
            batch python:here.ZenTableManager.getBatch(tableName,objects);">
        <input type='hidden' name='tableName' tal:attributes="value tableName"/>
        <input type="hidden" name="zenScreenName" 
                tal:attributes="value template/id"/>
        <tr>
          <th class=tabletitle align=left colspan="6"
            tal:content="string:Sub-${here/dmdRootName}">
            SubLocations
          </th>
        </tr>
        <span tal:condition="objects" tal:omit-tag="">
        <tr>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'primarySortKey','Name')">
            Name 
        </th>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'countChildren','Subs')">
            Subs
        </th>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'countDevices','Devices')">
            Devices
        </th>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'omniEventCount','Events')">
            Snmp
        </th>
        </tr>
        <tal:block tal:repeat="devorg batch">
          <tr tal:define = "odd repeat/devorg/odd" 
              tal:attributes="class python:test(odd, 'odd','even');">
            <td class="tablevalues" >
                <input tal:condition="here/isManager" 
                    type="checkbox" name="organizerPaths:list" 
                    tal:attributes="value devorg/getId"/>
                <a href="_" 
                tal:attributes="href devorg/getPrimaryUrlPath"
                tal:content="devorg/id">Name</a>
            </td>
            <td class="tablevalues" align=center 
                tal:content="devorg/countChildren"/>
            <td class="tablevalues" align=center 
                tal:content="devorg/countDevices"/>
            <td class="tablevalues">
            <table width="100%" 
                tal:on-error="structure string:
                    <span class='errorvalues'>Events unavailable</span>">
                <tr>
                    <td align=center width=16%
                    tal:repeat="evt python:devorg.getEventSummary()"
                    tal:attributes="class python:evt[0]">
                        <span tal:replace="python:'%d/%d' % (evt[1],evt[2])"/>
                    </td>
              </tr>
            </table>
            </td>
        </tr>
        </tal:block>
        <tr>
            <td colspan="6" class="tableheader">
                <span metal:use-macro="here/zenTableNavigation/macros/navbody"/>
            </td>
        </tr>
        </span>
        <tr tal:condition="here/isManager">
        <td class="tableheader" colspan="6">
        <span metal:define-macro="editor" tal:omit-tag="">
            <input class="tableheader" type="text" name="newPath"/>
            <input class="tableheader" type="submit" 
                name="manage_addOrganizer:method" value=" Add " /> 
            |
            <input class="tableheader" type="submit" name="moveOrganizer:method"
                    value="Move To" />
            <select class="tableheader" name="moveTarget"
            tal:define="targets here/childMoveTargets">
                <option value=""></option>
                <option tal:repeat="target targets" 
                    tal:content="target">/Server/Linux</option>
            </select> 
            |
            <input class="tableheader" type="submit" 
                name="manage_deleteOrganizers:method" value=" Delete " />
            |
            <input class="tableheader" type="submit"
                    name="SelectButton" value="Select All" 
                    onClick="toggleSelect(this.form);return false"/>
        </span>
        </td>
        </tr>
    </table>
    </form>

    <br tal:condition="here/devices/countObjects">

    <table metal:use-macro="here/deviceListMacro/macros/devList"></table>

</tal:block>
</tal:block>
