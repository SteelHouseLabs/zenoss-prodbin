<h2>Clear Heartbeats</h2>
<br/>
<p>
Are you sure you want to clear heartbeats for this device?<br/>
</p>
<script>
var dynamicDialog = Ext.getCmp('dynamic-dialog');
var oldSubmitHandler = dynamicDialog.submitHandler;
var newSubmitHandler = function(button, event) {

    var eam = Ext.create({xtype:'EventActionManager'});

    eam.configure({
        isLargeRequest: function() {
            return true;
        },
        onFinishAction: function() {
            Ext.getCmp('device_events').updateRows();
            Ext.getCmp('devdetailbar').refresh();
            Zenoss.message.info(String.format(
                '{0} events were updated.',
                this.eventsUpdated
            ));
            button.setHandler(oldSubmitHandler);
        },
        findParams: function() {
            console.log(Zenoss.env.device_uid.split('/'));
            return {
                params: Ext.encode({
                    eventState : [Zenoss.STATUS_NEW, Zenoss.STATUS_ACKNOWLEDGED],
                    eventClass : '/Status/Heartbeat',
                    device : Zenoss.env.device_uid.split('/').pop()
                })
            };
        }
    });

    eam.execute(Zenoss.remote.EventsRouter.close);
};
// This is pretty dependent on the submit button being the first button,
// but then again this entire .pt depends on the DynamicForm anyway.
dynamicDialog.buttons[0].setHandler(newSubmitHandler);
</script>
