<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">

<script type="text/javascript" src="/zport/js/MochiKit.js"></script>
<script type="text/javascript">
    
    function updateSelect(widget, options) {
        for (var i = widget.length; i < options.length; i++) {
            widget.options[i] = new Option(options[i],options[i], false, false);
        }
    }
    
    function getDeviceList() {
        var filter = document.getElementById('deviceFilter');
        var widget = document.getElementById('deviceId');
        var url = '/zport/dmd/Devices/jsonGetDeviceNames'
        var d = loadJSONDoc(url, {'query': filter.value});
        widget.options.length = 0;
        d.addBoth(updateSelect, widget);
    }
    
    function getComponentList() {
        var deviceWidget = document.getElementById('deviceId');
        var compWidget = document.getElementById('componentPath');
        var url = '/zport/dmd/Devices/jsonGetComponentPaths';
        var d = loadJSONDoc(url, {'deviceId': deviceWidget.value});
        compWidget.options.length = 0;
        //compWidget.options[0] = new Option(deviceWidget.value,
        //    '', false, false);
        d.addBoth(updateSelect, compWidget);
    }

    function getGraphList() {
        var deviceWidget = document.getElementById('deviceId');
        var compWidget = document.getElementById('componentPath');
        var graphWidget = document.getElementById('graphIds');
        var url = '/zport/dmd/Devices/jsonGetGraphIds';
        var d = loadJSONDoc(url, 
        {'deviceId': deviceWidget.value, 'componentPath': compWidget.value});
        graphWidget.options.length = 0;
        d.addBoth(updateSelect, graphWidget);
    }
        
    addLoadEvent(getDeviceList)
</script>

<form method="post"
    tal:attributes="action string:${here/absolute_url_path}">
    <input type="hidden" name="zenScreenName" 
        tal:attributes="value template/id" /> 


        <tal:block tal:define="tabletitle string: Graph Report">
        <tal:block metal:use-macro="here/zenuimacros/macros/zentable">

        <tal:block metal:fill-slot="zentablecontents">
        <!-- BEGIN TABLE CONTENTS -->
            
    <tr>
        <td class="tableheader">Name</td>
        <td class="tablevalues" tal:condition="here/isManager">
            <input class="tablevalues" type="text" name="newId" size="40"
                tal:attributes="value here/id" />
        </td>
        <td class="tablevalues" tal:condition="not:here/isManager"
            tal:content="here/id"/>
    </tr>
    <tr>
        <td class="tableheader">Comments</td>
        <td class="tablevalues" tal:condition="here/isManager">
            <textarea class="tablevalues" name="comments" rows="4" cols="60"
                tal:content="here/comments"></textarea>
        </td>
        <td class="tablevalues" tal:condition="not:here/isManager"
            tal:content="here/comments"/>
    </tr>
    <tr>
        <td class="tableheader">
        </td>
        <td class="tableheader" colspan="3">
            <input class="tableheader" type="submit" value=" Save "
                name="zmanage_editProperties:method" />
        </td>
    </tr>

        <!-- END TABLE CONTENTS -->

        </tal:block>
        </tal:block>
        </tal:block>
</form>
<br />

<form method="post" 
    tal:condition="here/isManager"
    tal:attributes="action string:${here/absolute_url_path}"
    tal:define="curDevice request/deviceId | nothing;
                curComponent request/componentPath | nothing;"
    >
    <input type="hidden" name="zenScreenName" 
        tal:attributes="value template/id" /> 


        <tal:block tal:define="tabletitle string:Add New Graph">
        <tal:block metal:use-macro="here/zenuimacros/macros/zentable">

        <tal:block metal:fill-slot="zentablecontents">
        <!-- BEGIN TABLE CONTENTS -->            
    <tr>
        <td class="tableheader">Device</td>
        <td class="tablevalues">
            <input class="tablevalues" type="text" name="deviceFilter"
                 id="deviceFilter" size="20" />
            <input class="tableheader" type="button" value="Filter" 
                name="filter" onClick="getDeviceList()" />
            <br />
            <select class="tablevalues" name="deviceId" id="deviceId" size="8"
                onChange="getComponentList(); getGraphList()">
            </select>
        </td>
	
    </tr>
    <tr>
        <td class="tableheader">Component</td>
        <td class="tablevalues">
            <select class="tablevalues" name="componentPath" size="6"
                id="componentPath"
                onChange="getGraphList()">
            </select>
        </td>
    </tr>
    <tr>
        <td class="tableheader">Graph</td>
        <td class="tablevalues">
            <select class="tablevalues" name="graphIds:list" size="6"
                id="graphIds"
                multiple="1">
            </select>
        </td>
    </tr>
    <tr>
        <td class="tableheader">
        </td>
        <td class="tableheader" colspan="3">
            <input class="tableheader" type="submit" value=" Add To Report "
                name="manage_addGraphElement:method" />
        </td>
    </tr>

        <!-- END TABLE CONTENTS -->

        </tal:block>
        </tal:block>
        </tal:block>
</form>
<br />

<form tal:attributes="method string:post;
                action here/absolute_url_path;
                name string:graphReportElementListform">
<input type="hidden" name="zenScreenName" tal:attributes="value template/id"/>


        <tal:block tal:define="tableName string:graphReportElementList; 
        objects here/elements;
        batch python:here.ZenTableManager.getBatch(tableName,objects,
                                                sortedHeader='sequence'); 
        tabletitle string:Graphs;
		menu_id string:GraphReportElement_list">
    <input type='hidden' name='tableName' tal:attributes="value tableName" />
        <tal:block metal:use-macro="here/zenuimacros/macros/zentable">

        <tal:block metal:fill-slot="zentablecontents">
        <!-- BEGIN TABLE CONTENTS -->
            
    <tal:block>
    <tr>
        <th tal:condition="here/isManager"
	    tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'sequence','Seq')"/>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'id','Name')"/>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'deviceId','Device')"/>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'getComponentDesc','Component')"/>
        <th tal:replace="structure python:here.ZenTableManager.getTableHeader(
                    tableName,'graphId','Graph')"/>
    </tr>
    <tr class="tablevalues" tal:repeat="element batch">
        <td valign="top" tal:condition="here/isManager">
            <input type="text" name="seqmap:list" size="2" 
		tal:attributes="value element/sequence"/>
            <input
                type="hidden" name="origseq:list"
                tal:attributes="value element/sequence" />
        </td>
        <td valign="top">
            <input tal:condition="here/isManager"
                type="checkbox" name="ids:list" 
                tal:attributes="value element/getId"/>
            <a tal:attributes="href element/getPrimaryUrlPath" 
                tal:content="element/getId">name</a>
        </td>
        <td valign="top" tal:content="element/deviceId"/>
        <td valign="top" tal:content="element/getComponentDesc"/>
        <td valign="top" tal:content="element/graphId"/>
    </tr>
    </tal:block>

        <!-- END TABLE CONTENTS -->

        </tal:block>
        </tal:block>
        </tal:block>
        
</form>


</tal:block>
</tal:block>
