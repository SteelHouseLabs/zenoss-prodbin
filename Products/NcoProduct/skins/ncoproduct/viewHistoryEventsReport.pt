<script metal:use-macro="here/miscmacros/macros/popupwindow"></script>
<tal:block
    tal:define="tableName string:viewhistoryevents;
    whereClause python:here.scHistoryEventInit(tableName);
    startdate python: here.scGetSortedTableState(tableName,'startdate');
    enddate python: here.scGetSortedTableState(tableName,'enddate');
    orderby python: here.scGetSortedTableState(tableName,'orderby');
    filteratt python: here.scSortedTableSetAtt(tableName,'filterattribute',
                                                'getAllEventText');
    sevlevel python: here.scSortedTableSetAtt(tableName,'severity',2);
    objects python:here.netcool.getHistoryEvents(startdate,enddate,
                                                    whereClause,orderby);
    batch python:here.scSortedTableGetBatch(tableName,objects,'');
    evcolspan python:len(here.netcool.resultFields)+1;">
<br>
<form action="_" method="post" tal:attributes="action request/URL">
    <table border="0" cellpadding="3" width="100%"
             align="center" bgcolor="#ffffff" cellspacing="1">
        <tr class=tableheader>
        <td>Start Date: 
            <span tal:replace="structure python:
                here.scDatePopup('start_date_pop', startdate)"/>
        </td>
        <td>End Date: 
            <span tal:replace="structure python:
                here.scDatePopup('end_date_pop', enddate)"/>
        </td>
            <td>
                <input type="submit" name="submit" value=" Search " />
            </td>
        </tr>
    </table>
</form>
<br>
<table border="0" cellpadding="3" width="100%" 
    align="center" bgcolor="#ffffff" cellspacing="1">
    <tr>
        <td class="tabletitle" colspan=3 tal:attributes="colspan evcolspan">
        <form action="_" method="POST" tal:attributes="action request/URL">
            History Events:
            &nbsp; &nbsp;
            <script type="text/javascript"><!--
                function entsub(event,ourform) {
                    if (event && event.which == 13)
                        ourform.submit();
                    else
                        return true;}
            --></script>
            <input type='hidden' name='tableName' value="_"
                tal:attributes="value tableName">
            Filter
            <input class="tableheader" type="text" name="filter" 
                size=25 value="_" onkeypress="return entsub(event, this.form)"
                tal:attributes="value python: here.scGetSortedTableState(
                                    tableName,'filter')">
            &nbsp; &nbsp;
            Severity Filter
            <span tal:replace="structure python:here.scGenericPopup(
                tableName, 'severity:int',
                here.netcool.getSeverities())"/>
        </form>    
        </td>
    </tr>
    <tr>
        <th tal:repeat="headername here/netcool/resultFields"
            tal:replace="structure python:here.scSortedTableHeader(
                    tableName,headername,headername,'cmp')">
            Name
        </th>
        <th class=tableheader> </th>
    </tr>
    <tr class="statusvalues" bgcolor="#FF0000" style="color: #000000;"
        tal:repeat="event batch"
        tal:attributes="bgcolor event/bgcolor; 
        style python: 'color:'+event.fgcolor">
        <span tal:repeat="index python: range(event.getfieldcount())">
        <td tal:content="python: event.getfield(index)">
            event data 
        </td>
        </span>
        <td>
            <a href="_"
                tal:attributes="href python:
                'javascript:popupwindow(\''+event.getHistoryEventDetailHref()
                +'\',\'ncoeventdetail'+str(event.ServerSerial)+'\',450,550)'">
                * 
            </a>
        </td>
    </tr>
    <tr>
        <td colspan=4 class="tableheader" align='center'
            tal:attributes="colspan evcolspan">
            <form metal:use-macro="here/miscmacros/macros/navtool"></form>
        </td>
    </tr>
</table>
</tal:block>
